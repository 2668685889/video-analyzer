# 错误处理指南

## 503 UNAVAILABLE 错误处理

### 问题描述
当您遇到以下错误时：
```
分析失败: 503 UNAVAILABLE. {'error': {'code': 503, 'message': 'The model is overloaded. Please try again later.', 'status': 'UNAVAILABLE'}}
```

这表示Gemini API服务器当前过载，无法处理您的请求。

### 自动重试机制

我们的应用程序已经内置了智能重试机制来处理这种情况：

#### 重试策略
- **最大重试次数**: 3次
- **重试延迟**: 指数退避策略
  - 第1次重试：等待2秒
  - 第2次重试：等待4秒
  - 第3次重试：等待8秒

#### 适用场景
自动重试机制会在遇到以下错误时触发：
- 503 UNAVAILABLE 错误
- 包含"overloaded"的错误信息
- 包含"unavailable"的错误信息
- 包含"rate limit"的错误信息

#### 重试过程
1. 当遇到服务器过载错误时，程序会自动显示重试信息
2. 程序会等待指定时间后自动重试
3. 如果3次重试后仍然失败，会显示最终错误信息

### 用户操作建议

#### 如果自动重试失败
1. **等待更长时间**: Gemini API服务器可能正在经历高峰期，建议等待5-10分钟后再试
2. **检查网络连接**: 确保您的网络连接稳定
3. **分批处理**: 如果有多个文件需要处理，建议分批进行，避免同时发送大量请求
4. **选择非高峰时段**: 尝试在用户较少的时段使用服务

#### 最佳实践
- **文件大小**: 尽量使用较小的视频文件以减少处理时间
- **简化提示**: 使用简洁明确的分析提示，避免过于复杂的要求
- **耐心等待**: 视频分析是计算密集型任务，需要一定的处理时间

### 其他常见错误

#### API密钥错误
```
错误: Invalid API key
```
**解决方案**: 检查设置中的API密钥是否正确配置

#### 文件格式错误
```
错误: Unsupported file format
```
**解决方案**: 确保上传的文件格式为支持的视频格式（mp4, avi, mov, mkv, webm）

#### 文件大小超限
```
错误: File size exceeds limit
```
**解决方案**: 确保视频文件大小不超过配置的最大限制（默认100MB）

### 技术细节

#### 重试机制实现
- 在`upload_file`方法中实现上传重试
- 在`analyze_video`方法中实现分析重试
- 使用指数退避算法避免对服务器造成额外压力

#### 错误检测
程序会检测错误信息中的关键词来判断是否需要重试：
- "503": HTTP 503状态码
- "overloaded": 服务器过载
- "unavailable": 服务不可用
- "rate limit": 速率限制

### 联系支持

如果问题持续存在，请：
1. 记录完整的错误信息
2. 记录出现问题的时间
3. 描述您正在处理的文件类型和大小
4. 联系技术支持获取进一步帮助