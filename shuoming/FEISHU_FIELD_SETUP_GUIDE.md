# 飞书多维表格字段设置指南

## 问题描述

当您看到 `FieldNameNotFound` 错误时，表明飞书多维表格中缺少必要的字段。这通常发生在以下情况：

1. 使用了新创建的空白多维表格
2. 表格中的字段名称与应用程序期望的不匹配
3. 字段类型设置不正确

## 解决方案

### 方案一：自动字段设置（推荐）

1. **确保应用权限**：
   - 确认飞书应用 `cli_a823d173b53a501c` 已被添加为多维表格的协作者
   - 分配「编辑」权限给应用

2. **使用应用程序自动设置**：
   - 在应用程序界面中点击「设置表格结构」按钮
   - 应用程序将自动创建所需的字段

### 方案二：手动字段设置

如果自动设置失败，请在飞书多维表格中手动创建以下字段：

| 字段名称 | 字段类型 | 是否必需 | 说明 |
|---------|---------|---------|------|
| 文件名称 | 单行文本 | 是 | 视频文件的名称 |
| 文件路径 | 单行文本 | 是 | 视频文件的完整路径 |
| 文件大小 | 数字 | 是 | 文件大小（字节） |
| 文件格式 | 单行文本 | 是 | 视频文件格式（如mp4、avi等） |
| 分析提示词 | 多行文本 | 是 | 用于分析的提示词 |
| 分析结果 | 多行文本 | 是 | AI分析的结果内容 |
| 创建时间 | 日期时间 | 是 | 记录创建时间 |
| 序列ID | 单行文本 | 是 | 唯一标识符 |
| 扣子调用ID | 单行文本 | 否 | 扣子API调用标识 |
| 标签 | 单行文本 | 否 | 自动生成的标签 |

### 字段创建步骤

1. **打开飞书多维表格**：
   - 访问您的多维表格链接
   - 确保您有编辑权限

2. **添加字段**：
   - 点击表格右上角的「+」按钮添加字段
   - 按照上表设置字段名称和类型
   - **注意**：字段名称必须完全匹配，包括中文字符

3. **验证字段设置**：
   - 确保所有必需字段都已创建
   - 检查字段类型是否正确

## 常见问题

### Q1: 字段名称不匹配怎么办？
**A**: 字段名称必须使用中文，且与应用程序定义完全一致。请检查是否有多余的空格或特殊字符。

### Q2: 自动设置失败怎么办？
**A**: 
1. 检查应用权限是否正确设置
2. 确认网络连接正常
3. 尝试手动创建字段
4. 查看应用程序日志获取详细错误信息

### Q3: 数据同步仍然失败？
**A**: 
1. 重启应用程序
2. 测试飞书连接
3. 检查字段类型是否匹配
4. 确认表格ID和应用Token配置正确

## 验证步骤

1. **测试连接**：
   - 在应用程序中点击「测试飞书连接」
   - 确认连接成功

2. **测试同步**：
   - 分析一个小视频文件
   - 检查是否成功同步到飞书表格

3. **检查数据**：
   - 在飞书表格中查看同步的数据
   - 确认所有字段都有正确的值

## 技术说明

应用程序使用以下字段映射逻辑：

```python
{
    "文件名称": record.get('file_name', ''),
    "文件路径": record.get('file_path', ''),
    "文件大小": record.get('file_size', 0),
    "文件格式": file_format,
    "分析提示词": record.get('analysis_prompt', ''),
    "分析结果": record.get('analysis_result', ''),
    "创建时间": self._format_datetime(record.get('created_at')),
    "序列ID": record.get('sequence_id', ''),
    "扣子调用ID": coze_id,
    "标签": tags
}
```

如果您需要修改字段名称，请同时更新应用程序代码中的字段映射。

---

**注意**：完成字段设置后，请重启应用程序以确保配置生效。