# 多视频批量分析功能说明

## 功能概述

本软件支持多视频文件的批量上传和分析功能，用户可以一次性选择多个视频文件，系统会按顺序逐个进行分析处理。

## 核心特性

### 1. 多文件选择
- 支持一次选择多个视频文件
- 自动文件格式验证和大小检查
- 重复文件检测和过滤
- 文件列表可视化显示

### 2. 顺序批量处理
- **按顺序处理**: 严格按照文件列表顺序逐个处理视频
- **完整流程**: 每个视频都会经历完整的上传→分析→结果返回流程
- **间隔控制**: 每个视频分析完成后自动等待5秒再处理下一个
- **状态跟踪**: 实时显示每个文件的处理状态

### 3. 进度管理
- 实时进度显示（当前文件/总文件数）
- 文件状态更新（待分析→分析中→完成/错误→等待）
- 等待状态提示（显示5秒倒计时信息）
- 批量分析统计信息

### 4. 结果管理
- 每个文件的分析结果独立存储
- 下拉框切换查看不同文件的结果
- 支持单独导出每个文件的分析结果
- 批量分析完成后显示统计信息

## 使用流程

### 步骤1: 选择多个视频文件
1. 点击"浏览文件"按钮
2. 在文件选择对话框中选择多个视频文件（支持Ctrl/Cmd多选）
3. 确认选择，文件将显示在文件列表中

### 步骤2: 设置分析提示词
1. 在提示词输入框中输入分析要求
2. 可以使用快速提示词功能选择预设模板

### 步骤3: 开始批量分析
1. 点击"开始分析"按钮
2. 系统开始按顺序处理每个视频文件
3. 观察文件列表中的状态变化和底部状态栏的进度信息

### 步骤4: 查看和管理结果
1. 分析完成后，使用结果区域的下拉框切换查看不同文件的结果
2. 点击"导出当前结果"按钮可导出当前显示的文件分析结果
3. 点击"保存结果"按钮可将所有结果保存到数据库

## 处理逻辑详解

### 批量处理流程
```
文件1: 上传 → 分析 → 返回结果 → 等待5秒
文件2: 上传 → 分析 → 返回结果 → 等待5秒
文件3: 上传 → 分析 → 返回结果 → 等待5秒
...
文件N: 上传 → 分析 → 返回结果 → 完成
```

### 状态说明
- **待分析**: 文件已添加到列表，等待处理
- **分析中**: 文件正在上传和分析
- **完成**: 文件分析成功完成
- **错误**: 文件分析过程中出现错误
- **等待**: 当前文件已完成，等待5秒后处理下一个文件

### 错误处理
- 单个文件分析失败不会影响其他文件的处理
- 失败的文件会标记为"错误"状态
- 即使出现错误，系统仍会等待5秒后继续处理下一个文件
- 批量分析完成后会显示成功和失败的文件统计

## 技术实现

### 文件处理器增强
- 新增`process_batch_video_analysis`方法支持批量处理
- 添加`time.sleep(5)`实现文件间隔控制
- 增强进度回调机制，支持等待状态通知

### UI界面优化
- 文件列表树形控件显示文件信息和状态
- 结果区域下拉框支持多文件结果切换
- 状态栏实时显示处理进度和等待信息
- 批量分析统计信息展示

### 状态管理
- 文件状态实时更新和显示
- 进度信息准确跟踪
- 等待状态友好提示
- 错误状态妥善处理

## 注意事项

1. **处理时间**: 由于每个文件都需要完整的上传和分析流程，加上5秒间隔，批量处理需要较长时间
2. **网络要求**: 确保网络连接稳定，避免上传过程中断
3. **文件大小**: 单个文件不超过100MB，建议选择合适大小的文件以提高处理效率
4. **API限制**: 注意Gemini API的调用频率限制，5秒间隔有助于避免触发限制
5. **资源占用**: 批量处理期间请勿关闭应用程序，保持系统稳定运行

## 故障排除

### 常见问题
1. **只处理第一个文件**: 已修复，现在会按顺序处理所有文件
2. **显示提示词内容**: 已修复，现在正确显示每个文件的分析结果
3. **处理中断**: 检查网络连接和API配置
4. **文件格式错误**: 确保选择支持的视频格式

### 调试信息
- 查看状态栏的实时进度信息
- 观察文件列表中的状态变化
- 检查结果区域的错误信息
- 查看应用程序控制台输出

---

**版本**: 1.0.0  
**更新日期**: 2024年12月  
**功能状态**: 已修复并测试通过