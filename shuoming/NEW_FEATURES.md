# 新功能说明文档

## 概述

本次更新为Gemini视频内容识别客户端新增了两个重要功能：
1. **快速提示自定义功能** - 允许用户创建、管理和使用自定义的分析提示模板
2. **视频分析历史记录管理** - 自动保存分析结果并提供完整的历史记录管理功能

## 功能详细说明

### 1. 快速提示自定义功能

#### 功能特点
- **预设提示模板**：系统内置5个常用的分析提示模板
- **自定义提示**：用户可以创建、编辑和删除自己的提示模板
- **提示预览**：实时预览选中提示的内容
- **一键应用**：快速将选中的提示应用到分析输入框

#### 内置提示模板
1. **视频摘要** - 生成视频的详细摘要分析
2. **内容分类** - 对视频内容进行分类和标签化
3. **关键信息提取** - 提取视频中的核心信息点
4. **情感分析** - 分析视频的情感表达和影响
5. **技术质量评估** - 评估视频的技术制作质量

#### 使用方法
1. **选择提示**：在主界面的"快速提示"下拉框中选择需要的提示模板
2. **预览内容**：在下方的预览框中查看提示的详细内容
3. **应用提示**：点击"应用提示"按钮将内容填入分析输入框
4. **管理提示**：点击"管理提示"按钮打开提示管理窗口

#### 提示管理功能
- **新建提示**：创建自定义的提示模板
- **编辑提示**：修改现有的自定义提示（默认提示不可编辑）
- **删除提示**：删除不需要的自定义提示（默认提示不可删除）
- **实时保存**：所有修改立即保存到数据库

### 2. 视频分析历史记录管理

#### 功能特点
- **自动保存**：每次分析完成后自动保存结果到数据库
- **22位序列号**：为每个分析记录生成唯一的22位序列号
- **完整记录**：保存文件信息、分析提示、分析结果等完整数据
- **搜索功能**：支持按文件名、提示内容、分析结果进行搜索
- **数据导出**：支持导出为CSV格式

#### 序列号格式
22位序列号格式：`YYYYMMDDHHMMSS + 8位随机字符`
- 前14位：时间戳（年月日时分秒）
- 后8位：随机字符（确保唯一性）

示例：`20241201143025A1B2C3D4`

#### 使用方法
1. **查看历史**：点击主界面的"📋 历史记录"按钮打开历史记录窗口
2. **搜索记录**：在搜索框中输入关键词进行搜索
3. **查看详情**：点击列表中的记录查看详细信息
4. **导出数据**：点击"导出CSV"按钮导出记录到文件
5. **删除记录**：选中记录后点击"删除记录"按钮

#### 历史记录界面功能
- **记录列表**：显示序列号、文件名、文件大小、分析时间
- **详情面板**：显示完整的分析提示和结果
- **操作功能**：复制结果、保存为文本文件
- **统计信息**：显示总记录数和搜索结果数

### 3. 数据存储结构

#### 视频分析记录表 (video_analysis)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键ID |
| sequence_id | TEXT | 22位唯一序列号 |
| file_path | TEXT | 文件完整路径 |
| file_name | TEXT | 文件名 |
| file_size | INTEGER | 文件大小（字节） |
| mime_type | TEXT | 文件MIME类型 |
| analysis_prompt | TEXT | 分析提示内容 |
| analysis_result | TEXT | 分析结果 |
| gemini_file_uri | TEXT | Gemini文件URI |
| gemini_file_name | TEXT | Gemini文件名 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

#### 快速提示表 (quick_prompts)
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键ID |
| name | TEXT | 提示名称 |
| prompt_text | TEXT | 提示内容 |
| description | TEXT | 提示描述 |
| is_default | BOOLEAN | 是否为默认提示 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

## 技术实现

### 文件结构
```
src/
├── utils/
│   └── database.py          # 数据库管理模块
├── ui/
│   ├── quick_prompts.py     # 快速提示管理界面
│   ├── history_viewer.py    # 历史记录查看界面
│   └── main_window.py       # 主界面（已更新）
└── shuoming/
    └── NEW_FEATURES.md      # 本说明文档
```

### 核心模块

#### 1. 数据库模块 (database.py)
- **VideoAnalysisDB类**：数据库操作的核心类
- **序列号生成**：`generate_sequence_id()` 方法生成22位唯一序列号
- **数据管理**：提供完整的CRUD操作
- **搜索功能**：支持模糊搜索和精确查询

#### 2. 快速提示管理 (quick_prompts.py)
- **QuickPromptsManager类**：提示管理的核心类
- **界面集成**：可嵌入到主界面中
- **实时预览**：提示内容的实时预览功能
- **管理窗口**：独立的提示管理界面

#### 3. 历史记录查看 (history_viewer.py)
- **HistoryViewer类**：历史记录管理的核心类
- **表格显示**：使用Treeview组件显示记录列表
- **详情面板**：分离式的详情显示面板
- **导出功能**：CSV格式的数据导出

## 使用注意事项

### 1. 数据库文件
- 数据库文件位置：项目根目录下的 `data.db`
- 首次运行时自动创建数据库和表结构
- 建议定期备份数据库文件

### 2. 性能考虑
- 历史记录默认显示最近1000条记录
- 大量数据时建议使用搜索功能缩小范围
- 定期清理不需要的历史记录

### 3. 数据安全
- 所有数据存储在本地SQLite数据库中
- 不会上传任何用户数据到外部服务器
- 删除操作不可恢复，请谨慎操作

### 4. 兼容性
- 支持Windows、macOS、Linux系统
- 需要Python 3.7+环境
- 依赖tkinter图形界面库

## 更新日志

### v2.0.0 (2024-12-01)
- ✅ 新增快速提示自定义功能
- ✅ 新增22位序列号生成器
- ✅ 新增视频分析历史记录管理
- ✅ 新增数据库存储模块
- ✅ 新增历史记录搜索和导出功能
- ✅ 优化主界面布局和用户体验
- ✅ 完善错误处理和重试机制

## 常见问题

### Q1: 如何备份我的提示模板和历史记录？
A1: 直接复制项目根目录下的 `data.db` 文件即可备份所有数据。

### Q2: 可以导入其他用户的提示模板吗？
A2: 目前不支持直接导入，但可以通过管理界面手动创建相同的提示模板。

### Q3: 历史记录会占用很多存储空间吗？
A3: 每条记录大约占用几KB空间，正常使用下不会占用太多空间。如有需要可定期清理旧记录。

### Q4: 序列号有什么作用？
A4: 序列号用于唯一标识每次分析，方便后续查找、引用和管理分析记录。

### Q5: 可以修改默认提示模板吗？
A5: 默认提示模板不可修改或删除，但可以创建自定义提示模板来满足特定需求。

## 技术支持

如果在使用过程中遇到问题，请检查：
1. Python环境是否正确安装
2. 所有依赖包是否已安装
3. 数据库文件是否有读写权限
4. 错误日志中的具体错误信息

更多技术细节请参考项目源代码和其他说明文档。