# æ™ºèƒ½å­—æ®µæ¨¡æ¿ç”ŸæˆåŠŸèƒ½ä½¿ç”¨ç¤ºä¾‹

## ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯1ï¼šè§†é¢‘å†…å®¹åˆ†æç»“æœæ¨¡æ¿ç”Ÿæˆ

å‡è®¾æ‚¨çš„å¤§æ¨¡å‹åˆ†æè§†é¢‘åè¿”å›ä»¥ä¸‹æ ¼å¼çš„ç»“æœï¼š

```json
{
  "video_serial_number": "20250321163301122334",
  "videoContentSummary": "ä¸€ä½èº«ç€ç™½è‰²ä¸Šè¡£çš„å¥³æ€§æ­£åœ¨è¿›è¡Œå¥èº«æ“ç»ƒä¹ ",
  "detailed_content_description": "è§†é¢‘å±•ç¤ºäº†ä¸€ä½å¥³æ€§åœ¨å®¤å†…è¿›è¡Œå¥èº«æ“ç»ƒä¹ ...",
  "keywords_tags": "å¥³æ€§, å¥èº«, å®¤å†…è¿åŠ¨, ç™½è‰²ä¸Šè¡£, å¥èº«æ“",
  "main_characters_objects": "å¥³æ€§å¥èº«æ•™ç»ƒ",
  "video_source_path": "å¥èº«æˆ¿/æ±½è½¦/Range Rover Sport FlyRamp Test 01.mp4"
}
```

### æ™ºèƒ½åˆ†æè¿‡ç¨‹

#### 1. å†…å®¹ç»“æ„è¯†åˆ«
ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«è¿™æ˜¯JSONæ ¼å¼çš„ç»“æ„åŒ–æ•°æ®ï¼Œå¹¶åˆ†ææ¯ä¸ªå­—æ®µçš„ç‰¹å¾ï¼š

- `video_serial_number`: æ•°å­—å­—ç¬¦ä¸² â†’ å•è¡Œæ–‡æœ¬
- `videoContentSummary`: çŸ­æè¿°æ–‡æœ¬ â†’ å•è¡Œæ–‡æœ¬  
- `detailed_content_description`: é•¿æè¿°æ–‡æœ¬ â†’ å¤šè¡Œæ–‡æœ¬
- `keywords_tags`: é€—å·åˆ†éš”çš„æ ‡ç­¾ â†’ å¤šè¡Œæ–‡æœ¬
- `main_characters_objects`: æè¿°æ€§æ–‡æœ¬ â†’ å•è¡Œæ–‡æœ¬
- `video_source_path`: æ–‡ä»¶è·¯å¾„ â†’ å•è¡Œæ–‡æœ¬

#### 2. å­—æ®µæ˜ å°„ç”Ÿæˆ
ç³»ç»Ÿä¼šç”Ÿæˆä»¥ä¸‹é£ä¹¦å­—æ®µæ˜ å°„ï¼š

| åŸå­—æ®µå | ä¸­æ–‡å­—æ®µå | é£ä¹¦å­—æ®µç±»å‹ | è¯´æ˜ |
|---------|-----------|-------------|------|
| video_serial_number | è§†é¢‘åºåˆ—å· | å•è¡Œæ–‡æœ¬(1) | å”¯ä¸€æ ‡è¯†ç¬¦ |
| videoContentSummary | å†…å®¹æ‘˜è¦ | å•è¡Œæ–‡æœ¬(1) | ç®€çŸ­æè¿° |
| detailed_content_description | è¯¦ç»†å†…å®¹æè¿° | å¤šè¡Œæ–‡æœ¬(1) | å®Œæ•´æè¿° |
| keywords_tags | å…³é”®è¯æ ‡ç­¾ | å¤šè¡Œæ–‡æœ¬(1) | æ ‡ç­¾åˆ—è¡¨ |
| main_characters_objects | ä¸»è¦è§’è‰²å¯¹è±¡ | å•è¡Œæ–‡æœ¬(1) | ä¸»è¦å…ƒç´  |
| video_source_path | è§†é¢‘æºè·¯å¾„ | å•è¡Œæ–‡æœ¬(1) | æ–‡ä»¶ä½ç½® |

### åœºæ™¯2ï¼šå¤æ‚ç»“æ„åŒ–æ•°æ®å¤„ç†

å¯¹äºæ›´å¤æ‚çš„åˆ†æç»“æœï¼š

```json
{
  "basic_info": {
    "duration": 120,
    "resolution": "1920x1080",
    "file_size": 45.6
  },
  "content_analysis": {
    "scene_count": 5,
    "has_dialogue": true,
    "emotion_score": 8.5,
    "content_rating": "é€‚åˆæ‰€æœ‰å¹´é¾„"
  },
  "technical_details": {
    "codec": "H.264",
    "bitrate": "2000kbps",
    "frame_rate": 30
  }
}
```

ç³»ç»Ÿä¼šæ™ºèƒ½å±•å¹³ç»“æ„å¹¶åˆ›å»ºå¯¹åº”å­—æ®µï¼š

- `duration` â†’ æ—¶é•¿(æ•°å­—ç±»å‹)
- `resolution` â†’ åˆ†è¾¨ç‡(å•è¡Œæ–‡æœ¬)
- `file_size` â†’ æ–‡ä»¶å¤§å°(æ•°å­—ç±»å‹)
- `scene_count` â†’ åœºæ™¯æ•°é‡(æ•°å­—ç±»å‹)
- `has_dialogue` â†’ åŒ…å«å¯¹è¯(å¤é€‰æ¡†)
- `emotion_score` â†’ æƒ…æ„Ÿè¯„åˆ†(æ•°å­—ç±»å‹)
- `content_rating` â†’ å†…å®¹è¯„çº§(å•è¡Œæ–‡æœ¬)

## å®é™…æ“ä½œæ­¥éª¤

### æ­¥éª¤1ï¼šå‡†å¤‡å†å²æ•°æ®

1. é¦–å…ˆåˆ†æå‡ ä¸ªè§†é¢‘æ–‡ä»¶ï¼Œç¡®ä¿æ•°æ®åº“ä¸­æœ‰å†å²è®°å½•ï¼š
   ```
   é€‰æ‹©è§†é¢‘æ–‡ä»¶ â†’ è¾“å…¥åˆ†ææç¤ºè¯ â†’ å¼€å§‹åˆ†æ
   ```

2. ç¡®è®¤åˆ†æç»“æœå·²ä¿å­˜åˆ°æ•°æ®åº“

### æ­¥éª¤2ï¼šæ‰§è¡Œæ™ºèƒ½è®¾ç½®

1. ç‚¹å‡»ä¸»ç•Œé¢çš„ã€Œè®¾ç½®è¡¨æ ¼ç»“æ„ã€æŒ‰é’®
2. åœ¨ç¡®è®¤å¯¹è¯æ¡†ä¸­ç‚¹å‡»ã€Œç¡®å®šã€
3. ç­‰å¾…ç³»ç»Ÿå¤„ç†ï¼ˆé€šå¸¸éœ€è¦10-30ç§’ï¼‰

### æ­¥éª¤3ï¼šæŸ¥çœ‹è®¾ç½®ç»“æœ

æˆåŠŸæ—¶ä¼šæ˜¾ç¤ºç±»ä¼¼ä¿¡æ¯ï¼š
```
æ™ºèƒ½å­—æ®µæ¨¡æ¿ç”Ÿæˆå®Œæˆï¼

ğŸ“Š åˆ†ææ‘˜è¦ï¼š
â€¢ åˆ†æäº† 10 æ¡å†å²è®°å½•
â€¢ æ£€æµ‹åˆ° 15 ä¸ªå­—æ®µ
â€¢ ç½®ä¿¡åº¦ç­‰çº§ï¼šhigh

ğŸ“‹ æ¨¡æ¿æ‘˜è¦ï¼š
â€¢ ç”Ÿæˆäº† 12 ä¸ªå­—æ®µ
â€¢ å­—æ®µç±»å‹åˆ†å¸ƒï¼š æ–‡æœ¬(5) æ•°å­—(2) å•é€‰(3) å¤šé€‰(2)

ğŸ“„ æ¨¡æ¿å·²ä¿å­˜åˆ°ï¼š
/path/to/templates/smart_field_template_20240120_103000.json

ğŸ“ ä¸‹ä¸€æ­¥æ“ä½œï¼š
1. æ‰“å¼€é£ä¹¦å¤šç»´è¡¨æ ¼
2. æ ¹æ®ç”Ÿæˆçš„æ¨¡æ¿æ‰‹åŠ¨åˆ›å»ºå­—æ®µ
3. å®Œæˆåå³å¯æ­£å¸¸åŒæ­¥æ•°æ®

ğŸ”§ å­—æ®µåˆ›å»ºæŒ‡å—ï¼š
1. åˆ›å»ºæ–‡æœ¬ç±»å‹å­—æ®µï¼šè§†é¢‘æ ‡é¢˜
2. åˆ›å»ºæ•°å­—ç±»å‹å­—æ®µï¼šè§†é¢‘æ—¶é•¿
3. åˆ›å»ºå•é€‰ç±»å‹å­—æ®µï¼šæƒ…æ„Ÿåˆ†æ
... ç­‰å…± 12 ä¸ªå­—æ®µ
```

#### ç”Ÿæˆçš„å­—æ®µåˆ—è¡¨
- ğŸ“ è§†é¢‘æ ‡é¢˜ (æ–‡æœ¬)
- ğŸ”¢ è§†é¢‘æ—¶é•¿ (æ•°å­—)
- ğŸ“‹ ä¸»è¦è§’è‰² (å¤šé€‰)
- ğŸ¯ æƒ…æ„Ÿåˆ†æ (å•é€‰)
- ğŸ·ï¸ å…³é”®è¯ (å¤šé€‰)
- ğŸ“… åˆ†ææ—¶é—´ (æ—¥æœŸæ—¶é—´)
- ğŸ“Š ç½®ä¿¡åº¦åˆ†æ•° (æ•°å­—)
- ğŸ¬ è§†é¢‘ç±»å‹ (å•é€‰)

## ç”Ÿæˆçš„æ¨¡æ¿æ–‡ä»¶ç¤ºä¾‹

```json
{
  "template_info": {
    "name": "æ™ºèƒ½ç”Ÿæˆçš„é£ä¹¦å­—æ®µæ¨¡æ¿",
    "version": "1.0",
    "created_at": "2024-01-20T10:30:00.123456",
    "based_on_records": 8
  },
  "analysis_summary": {
    "content_type": "json",
    "structure_complexity": "medium",
    "detected_fields_count": 12,
    "confidence_level": "high"
  },
  "feishu_fields": [
    {
      "field_name": "è§†é¢‘åºåˆ—å·",
      "field_type": 1,
      "description": "è§†é¢‘çš„å”¯ä¸€æ ‡è¯†ç¬¦",
      "source_field": "video_serial_number"
    },
    {
      "field_name": "å†…å®¹æ‘˜è¦",
      "field_type": 1,
      "description": "è§†é¢‘å†…å®¹çš„ç®€çŸ­æ‘˜è¦",
      "source_field": "videoContentSummary"
    },
    {
      "field_name": "è¯¦ç»†å†…å®¹æè¿°",
      "field_type": 1,
      "description": "è§†é¢‘å†…å®¹çš„è¯¦ç»†æè¿°",
      "source_field": "detailed_content_description"
    },
    {
      "field_name": "å…³é”®è¯æ ‡ç­¾",
      "field_type": 1,
      "description": "è§†é¢‘ç›¸å…³çš„å…³é”®è¯å’Œæ ‡ç­¾",
      "source_field": "keywords_tags"
    },
    {
      "field_name": "ä¸»è¦è§’è‰²å¯¹è±¡",
      "field_type": 1,
      "description": "è§†é¢‘ä¸­çš„ä¸»è¦äººç‰©æˆ–å¯¹è±¡",
      "source_field": "main_characters_objects"
    },
    {
      "field_name": "è§†é¢‘æºè·¯å¾„",
      "field_type": 1,
      "description": "è§†é¢‘æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„",
      "source_field": "video_source_path"
    }
  ],
  "field_mapping": {
    "video_serial_number": "è§†é¢‘åºåˆ—å·",
    "videoContentSummary": "å†…å®¹æ‘˜è¦",
    "detailed_content_description": "è¯¦ç»†å†…å®¹æè¿°",
    "keywords_tags": "å…³é”®è¯æ ‡ç­¾",
    "main_characters_objects": "ä¸»è¦è§’è‰²å¯¹è±¡",
    "video_source_path": "è§†é¢‘æºè·¯å¾„"
  },
  "sample_data": [
    {
      "video_serial_number": "20250321163301122334",
      "videoContentSummary": "ä¸€ä½èº«ç€ç™½è‰²ä¸Šè¡£çš„å¥³æ€§æ­£åœ¨è¿›è¡Œå¥èº«æ“ç»ƒä¹ ",
      "detailed_content_description": "è§†é¢‘å±•ç¤ºäº†ä¸€ä½å¥³æ€§åœ¨å®¤å†…è¿›è¡Œå¥èº«æ“ç»ƒä¹ ..."
    }
  ],
  "setup_instructions": {
    "manual_steps": [
      {
        "step": 1,
        "field_name": "è§†é¢‘åºåˆ—å·",
        "field_type": "å•è¡Œæ–‡æœ¬",
        "description": "åˆ›å»ºå•è¡Œæ–‡æœ¬å­—æ®µï¼Œç”¨äºå­˜å‚¨è§†é¢‘å”¯ä¸€æ ‡è¯†ç¬¦",
        "config_notes": "è®¾ç½®ä¸ºå¿…å¡«å­—æ®µ"
      },
      {
        "step": 2,
        "field_name": "å†…å®¹æ‘˜è¦",
        "field_type": "å•è¡Œæ–‡æœ¬",
        "description": "åˆ›å»ºå•è¡Œæ–‡æœ¬å­—æ®µï¼Œç”¨äºå­˜å‚¨è§†é¢‘å†…å®¹ç®€çŸ­æ‘˜è¦",
        "config_notes": "å»ºè®®è®¾ç½®å­—ç¬¦é•¿åº¦é™åˆ¶"
      },
      {
        "step": 3,
        "field_name": "è¯¦ç»†å†…å®¹æè¿°",
        "field_type": "å¤šè¡Œæ–‡æœ¬",
        "description": "åˆ›å»ºå¤šè¡Œæ–‡æœ¬å­—æ®µï¼Œç”¨äºå­˜å‚¨è¯¦ç»†çš„è§†é¢‘å†…å®¹æè¿°",
        "config_notes": "æ”¯æŒé•¿æ–‡æœ¬è¾“å…¥"
      },
      {
        "step": 4,
        "field_name": "å…³é”®è¯æ ‡ç­¾",
        "field_type": "å¤šè¡Œæ–‡æœ¬",
        "description": "åˆ›å»ºå¤šè¡Œæ–‡æœ¬å­—æ®µï¼Œç”¨äºå­˜å‚¨å…³é”®è¯å’Œæ ‡ç­¾",
        "config_notes": "å¯ä»¥å­˜å‚¨é€—å·åˆ†éš”çš„æ ‡ç­¾"
      },
      {
        "step": 5,
        "field_name": "ä¸»è¦è§’è‰²å¯¹è±¡",
        "field_type": "å•è¡Œæ–‡æœ¬",
        "description": "åˆ›å»ºå•è¡Œæ–‡æœ¬å­—æ®µï¼Œç”¨äºå­˜å‚¨ä¸»è¦äººç‰©æˆ–å¯¹è±¡ä¿¡æ¯",
        "config_notes": "æè¿°æ€§æ–‡æœ¬å­—æ®µ"
      },
      {
        "step": 6,
        "field_name": "è§†é¢‘æºè·¯å¾„",
        "field_type": "å•è¡Œæ–‡æœ¬",
        "description": "åˆ›å»ºå•è¡Œæ–‡æœ¬å­—æ®µï¼Œç”¨äºå­˜å‚¨è§†é¢‘æ–‡ä»¶è·¯å¾„",
        "config_notes": "å­˜å‚¨æ–‡ä»¶ä½ç½®ä¿¡æ¯"
      }
    ],
    "notes": [
      "åˆ›å»ºå­—æ®µæ—¶è¯·ä¿æŒå­—æ®µåç§°ä¸æ¨¡æ¿å®Œå…¨ä¸€è‡´",
      "å¯æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´å­—æ®µé…ç½®å’Œé€‰é¡¹",
      "å»ºè®®æŒ‰ç…§æ­¥éª¤é¡ºåºä¾æ¬¡åˆ›å»ºå­—æ®µ",
      "å®Œæˆå­—æ®µåˆ›å»ºåå³å¯å¼€å§‹æ•°æ®åŒæ­¥"
    ]
  }
}
```

## å¸¸è§é—®é¢˜å¤„ç†

### Q1: æ™ºèƒ½è®¾ç½®å¤±è´¥ï¼Œæç¤º"æ²¡æœ‰æ‰¾åˆ°å†å²è®°å½•"

**è§£å†³æ–¹æ¡ˆï¼š**
1. å…ˆåˆ†æå‡ ä¸ªè§†é¢‘æ–‡ä»¶
2. ç¡®ä¿åˆ†æç»“æœä¸ä¸ºç©º
3. æ£€æŸ¥æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸

### Q2: æ¨¡æ¿ç”ŸæˆæˆåŠŸä½†å­—æ®µåˆ›å»ºå›°éš¾

**ç°è±¡ï¼š**
```
æ™ºèƒ½å­—æ®µæ¨¡æ¿ç”Ÿæˆå®Œæˆï¼
æ¨¡æ¿å·²ä¿å­˜ï¼Œä½†æ‰‹åŠ¨åˆ›å»ºå­—æ®µæ—¶é‡åˆ°å›°éš¾
```

**åŸå› åˆ†æï¼š**
- å¯¹é£ä¹¦å­—æ®µç±»å‹ä¸ç†Ÿæ‚‰
- å­—æ®µé…ç½®é€‰é¡¹ä¸æ¸…æ¥š
- å­—æ®µåç§°æˆ–ç±»å‹é€‰æ‹©æœ‰ç–‘é—®

**è§£å†³æ–¹æ¡ˆï¼š**
1. ä»”ç»†é˜…è¯»æ¨¡æ¿æ–‡ä»¶ä¸­çš„ `setup_instructions` éƒ¨åˆ†
2. å‚è€ƒæ¯ä¸ªå­—æ®µçš„ `config_notes` é…ç½®è¯´æ˜
3. æŒ‰ç…§ `manual_steps` çš„æ­¥éª¤é¡ºåºä¾æ¬¡åˆ›å»º
4. å¦‚æœ‰ç–‘é—®ï¼Œå¯ä»¥ç®€åŒ–å­—æ®µç±»å‹ï¼ˆå¦‚å°†å¤æ‚ç±»å‹æ”¹ä¸ºæ–‡æœ¬ç±»å‹ï¼‰

### Q3: å­—æ®µç±»å‹ä¸ç¬¦åˆé¢„æœŸ

**è§£å†³æ–¹æ¡ˆï¼š**
1. æŸ¥çœ‹ç”Ÿæˆçš„æ¨¡æ¿æ–‡ä»¶
2. æ‰‹åŠ¨ä¿®æ”¹é£ä¹¦è¡¨æ ¼ä¸­çš„å­—æ®µç±»å‹
3. æˆ–è€…ä¿®æ”¹ `field_mapper.py` ä¸­çš„æ¨æ–­è§„åˆ™

## é«˜çº§ç”¨æ³•

### 1. è‡ªå®šä¹‰å­—æ®µæ˜ å°„è§„åˆ™

å¯ä»¥é€šè¿‡ä¿®æ”¹ `field_mapper.py` æ¥è‡ªå®šä¹‰å­—æ®µç±»å‹æ¨æ–­è§„åˆ™ï¼š

```python
# åœ¨ field_mapper.py ä¸­æ·»åŠ è‡ªå®šä¹‰è§„åˆ™
def custom_field_type_inference(content):
    if "è¯„åˆ†" in content:
        return "number"    # æ•°å­—å­—æ®µç”¨äºè¯„åˆ†
    elif "é“¾æ¥" in content:
        return "url"       # URLå­—æ®µ
    elif "æ ‡ç­¾" in content:
        return "multi_select"  # å¤šé€‰å­—æ®µç”¨äºæ ‡ç­¾
    # ... æ›´å¤šè‡ªå®šä¹‰è§„åˆ™
```

### 2. æ¨¡æ¿æ–‡ä»¶ç®¡ç†

```python
# åŠ è½½å·²æœ‰æ¨¡æ¿æ–‡ä»¶
import json
with open('templates/previous_template.json', 'r') as f:
    template = json.load(f)
    
# æ ¹æ®æ¨¡æ¿æ‰‹åŠ¨åˆ›å»ºå­—æ®µ
for field in template['feishu_fields']:
    print(f"åˆ›å»ºå­—æ®µï¼š{field['field_name']} ({field['field_type']})")
    # æ‰‹åŠ¨åœ¨é£ä¹¦ä¸­åˆ›å»ºå¯¹åº”å­—æ®µ
```

### 3. æ‰¹é‡æ¨¡æ¿ç”Ÿæˆ

```python
# ä¸ºä¸åŒç±»å‹çš„åˆ†æç”Ÿæˆä¸åŒæ¨¡æ¿
analysis_types = ["è§†é¢‘å†…å®¹", "éŸ³é¢‘è½¬å½•", "å›¾åƒè¯†åˆ«"]
for analysis_type in analysis_types:
    smart_setup = SmartFieldSetup(db, feishu_client)
    result = smart_setup.run_smart_setup(
        save_template=True,
        template_name=f"{analysis_type}_template"
    )
    print(f"{analysis_type} æ¨¡æ¿ç”Ÿæˆç»“æœï¼š{result['status']}")
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å†å²è®°å½•æ•°é‡**ï¼šå»ºè®®åˆ†æ5-15æ¡è®°å½•ï¼Œè¿‡å¤šä¼šå½±å“æ€§èƒ½
2. **ç½‘ç»œä¼˜åŒ–**ï¼šåœ¨ç½‘ç»œè‰¯å¥½çš„ç¯å¢ƒä¸‹æ‰§è¡Œ
3. **åˆ†æ‰¹åˆ›å»º**ï¼šå¯¹äºå¤§é‡å­—æ®µï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†æ‰¹åˆ›å»º
4. **ç¼“å­˜æœºåˆ¶**ï¼šé‡å¤è¿è¡Œæ—¶ä¼šè·³è¿‡å·²å­˜åœ¨çš„å­—æ®µ

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„å­—æ®µç±»å‹æ”¯æŒ

1. åœ¨ `FieldMapper` ç±»ä¸­æ·»åŠ æ–°çš„å­—æ®µç±»å‹ï¼š
```python
self.feishu_field_types['custom_type'] = 999
```

2. æ·»åŠ å¯¹åº”çš„æ¨æ–­é€»è¾‘ï¼š
```python
def _detect_custom_type(self, value: str) -> bool:
    # è‡ªå®šä¹‰æ£€æµ‹é€»è¾‘
    return pattern_match(value)
```

### é›†æˆå¤–éƒ¨AIæœåŠ¡

å¯ä»¥é›†æˆå…¶ä»–AIæœåŠ¡æ¥æé«˜å­—æ®µç±»å‹æ¨æ–­çš„å‡†ç¡®æ€§ï¼š

```python
def _ai_enhanced_inference(self, content: str) -> Dict[str, Any]:
    # è°ƒç”¨å¤–éƒ¨AIæœåŠ¡
    ai_result = external_ai_service.analyze(content)
    return self._merge_inference_results(ai_result, self._basic_inference(content))
```

è¿™ä¸ªæ™ºèƒ½å­—æ®µè®¾ç½®åŠŸèƒ½å¤§å¤§ç®€åŒ–äº†é£ä¹¦å¤šç»´è¡¨æ ¼çš„é…ç½®è¿‡ç¨‹ï¼Œè®©æ‚¨å¯ä»¥ä¸“æ³¨äºè§†é¢‘å†…å®¹åˆ†æï¼Œè€Œä¸ç”¨æ‹…å¿ƒè¡¨æ ¼ç»“æ„çš„è®¾ç½®é—®é¢˜ã€‚