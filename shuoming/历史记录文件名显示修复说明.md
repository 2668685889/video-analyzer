# 历史记录文件名显示修复说明

## 问题描述
用户报告在文件夹监控自动分析新文件时，历史记录中无法正确显示文件名称。

## 问题分析

### 1. 数据库保存逻辑检查
- 检查了 `main_window.py` 中的 `handle_analysis_result` 方法
- 确认文件名通过 `os.path.basename(self.current_file_path)` 正确提取
- 数据库中的文件名字段正确保存

### 2. 历史记录显示逻辑检查
- 检查了 `history_viewer.py` 中的 `_update_tree_view` 方法
- 确认文件名通过 `record.get('file_name', '')` 正确获取和显示
- 显示逻辑本身没有问题

### 3. 数据库验证
通过SQL查询确认数据库中的文件名都是正确保存的：
```sql
SELECT sequence_id, file_name, file_path, created_at FROM video_analysis ORDER BY created_at DESC LIMIT 5;
```

### 4. 问题根因
经过分析，问题可能是由于文件名列宽度不够导致长文件名显示不完整，用户误认为文件名显示不正确。

## 修复方案

### 增加文件名列宽度
在 `src/ui/history_viewer.py` 中修改文件名列的宽度设置：

**修改前：**
```python
self.tree.column("文件名", width=180, minwidth=150)
```

**修改后：**
```python
self.tree.column("文件名", width=250, minwidth=200)  # 增加文件名列宽度
```

### 修改详情
- 将文件名列宽度从 180 增加到 250
- 将最小宽度从 150 增加到 200
- 确保长文件名能够完整显示

## 测试验证

### 1. 数据库验证
- 确认数据库中文件名正确保存
- 验证自动分析和手动分析的文件名保存逻辑一致

### 2. UI显示验证
- 增加列宽度后，长文件名应该能够完整显示
- 用户界面更加友好

## 相关文件
- `src/ui/history_viewer.py` - 历史记录界面，修改了文件名列宽度
- `src/ui/main_window.py` - 主窗口，包含文件名保存逻辑
- `src/utils/database.py` - 数据库操作，文件名保存到数据库

## 修复状态
✅ 已完成 - 文件名列宽度已增加，应该能解决显示不完整的问题

## 注意事项
1. 如果问题仍然存在，可能需要进一步检查具体的文件名内容
2. 建议用户重启应用程序以确保修改生效
3. 可以通过调整列宽度来适应不同长度的文件名

---
*修复时间：2025-08-24*
*修复人员：AI助理*