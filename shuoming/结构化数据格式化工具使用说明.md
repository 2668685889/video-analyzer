# 结构化数据格式化工具使用说明

## 概述

结构化数据格式化工具（`structured_data_formatter.py`）是专门为解决截图中输出参数配置问题而设计的工具。该工具能够将多组杂乱的输入数据转换为结构化的对象数组输出，实现一组一组对应的数据处理。

## 问题分析

### 截图中的问题

根据您提供的截图，当前的输出参数配置存在以下问题：

1. **输出结构不正确**：截图显示的是扁平化的单个字段配置
2. **缺少数组结构**：没有配置为数组类型来处理多组数据
3. **一对一映射错误**：无法实现多组输入对应多组输出的结构

### 正确的输出结构

应该配置为：**Array<Object>** 结构，其中每个对象包含5个字符串字段。

## 正确的输出参数配置

### 在截图界面中的配置方式

```
输出参数配置:
├── 主输出类型: Array (数组)
└── 数组元素类型: Object (对象)
    ├── video_serial_number: String
    ├── video_content_summary: String  
    ├── detailed_content_description: String
    ├── keyword_tags: String
    └── main_objects: String
```

### 具体配置步骤

1. **第一步：设置主输出类型**
   - 选择：`Array` (数组类型)
   - 不要选择单个字段类型

2. **第二步：定义数组元素结构**
   - 数组元素类型：`Object`
   - 对象包含5个字段

3. **第三步：配置对象字段**
   ```
   字段名                        | 类型    | 说明
   video_serial_number          | String  | 视频序列号
   video_content_summary        | String  | 视频内容摘要
   detailed_content_description | String  | 详细内容描述
   keyword_tags                 | String  | 关键词标签
   main_objects                 | String  | 主要对象
   ```

## 输入输出示例

### 输入格式（多组数据）

```json
[
  {
    "video_serial_number": "VIDEO_001",
    "video_content_summary": "第一个视频的内容摘要",
    "detailed_content_description": "第一个视频的详细内容描述",
    "keyword_tags": "关键词1, 关键词2, 关键词3",
    "main_objects": "主要对象1, 主要对象2"
  },
  {
    "video_serial_number": "VIDEO_002",
    "video_content_summary": "第二个视频的内容摘要",
    "detailed_content_description": "第二个视频的详细内容描述",
    "keyword_tags": "关键词4, 关键词5, 关键词6",
    "main_objects": "主要对象3, 主要对象4"
  }
]
```

### 输出格式（结构化数组）

```json
[
  {
    "video_serial_number": "VIDEO_001",
    "video_content_summary": "第一个视频的内容摘要",
    "detailed_content_description": "第一个视频的详细内容描述",
    "keyword_tags": "关键词1, 关键词2, 关键词3",
    "main_objects": "主要对象1, 主要对象2"
  },
  {
    "video_serial_number": "VIDEO_002",
    "video_content_summary": "第二个视频的内容摘要",
    "detailed_content_description": "第二个视频的详细内容描述",
    "keyword_tags": "关键词4, 关键词5, 关键词6",
    "main_objects": "主要对象3, 主要对象4"
  }
]
```

## 使用方法

### 1. 基本使用

```python
from structured_data_formatter import StructuredDataFormatter

# 创建格式化器实例
formatter = StructuredDataFormatter()

# 处理多组数据
json_data = '''[
  {
    "video_serial_number": "VIDEO_001",
    "video_content_summary": "视频内容摘要",
    "detailed_content_description": "详细内容描述",
    "keyword_tags": "关键词标签",
    "main_objects": "主要对象"
  }
]'''

# 获取结构化输出
result = formatter.format_data(json_data)
print(result)  # 返回对象数组
```

### 2. 获取JSON格式输出

```python
# 获取格式化的JSON字符串
json_output = formatter.format_data_as_json(json_data)
print(json_output)
```

### 3. 保存到文件

```python
# 保存为JSON文件
json_file = formatter.save_formatted_data(json_data, "output.json", "json")

# 保存为文本文件
text_file = formatter.save_formatted_data(json_data, "output.txt", "text")
```

### 4. 查看输出结构信息

```python
# 获取输出结构信息
structure_info = formatter.get_output_structure_info()
print(structure_info)
```

## 输出结构详解

### 数据类型说明

```python
{
    "output_type": "Array<Object>",
    "description": "返回对象数组，每个对象包含5个字符串字段",
    "fields": [
        "video_serial_number",
        "video_content_summary", 
        "detailed_content_description",
        "keyword_tags",
        "main_objects"
    ],
    "field_types": {
        "video_serial_number": "String",
        "video_content_summary": "String",
        "detailed_content_description": "String",
        "keyword_tags": "String",
        "main_objects": "String"
    }
}
```

### 一组一组对应关系

```
输入第1组数据 → 输出第1个对象
输入第2组数据 → 输出第2个对象
输入第3组数据 → 输出第3个对象
...
输入第N组数据 → 输出第N个对象
```

## API 参考

### StructuredDataFormatter 类

#### 构造函数
```python
StructuredDataFormatter(field_mapping=None)
```
- `field_mapping` (dict, optional): 自定义字段映射配置

#### 主要方法

##### format_data(json_str)
格式化JSON数据为结构化对象数组
- **参数**: `json_str` (str) - JSON字符串
- **返回**: `list` - 结构化的对象数组

##### format_data_as_json(json_str, indent=2)
格式化数据为JSON字符串
- **参数**: 
  - `json_str` (str) - JSON字符串
  - `indent` (int) - JSON缩进空格数
- **返回**: `str` - 格式化后的JSON字符串

##### save_formatted_data(json_str, output_file=None, format_type="json")
保存格式化数据到文件
- **参数**: 
  - `json_str` (str) - JSON字符串
  - `output_file` (str, optional) - 输出文件路径
  - `format_type` (str) - 输出格式类型
- **返回**: `str` - 保存的文件路径

##### get_output_structure_info()
获取输出结构信息
- **返回**: `dict` - 输出结构信息

## 与之前工具的区别

| 特性 | 英文扁平化工具 | 结构化数据工具 |
|------|----------------|----------------|
| 输出类型 | 格式化文本字符串 | 结构化对象数组 |
| 数据结构 | 扁平化文本 | Array<Object> |
| 一组一组对应 | ❌ 文本格式无法直接对应 | ✅ 完美支持 |
| API调用友好 | ❌ 需要解析文本 | ✅ 直接使用对象 |
| 截图配置适用 | ❌ 不适合截图需求 | ✅ 完全匹配 |

## 实际应用场景

### 场景1：视频批量分析

```python
# 输入：3个视频的分析结果
input_data = [
    {"video_serial_number": "V001", "video_content_summary": "教育视频", ...},
    {"video_serial_number": "V002", "video_content_summary": "娱乐视频", ...},
    {"video_serial_number": "V003", "video_content_summary": "新闻视频", ...}
]

# 输出：3个结构化对象
output_data = [
    {"video_serial_number": "V001", "video_content_summary": "教育视频", ...},
    {"video_serial_number": "V002", "video_content_summary": "娱乐视频", ...},
    {"video_serial_number": "V003", "video_content_summary": "新闻视频", ...}
]
```

### 场景2：API接口返回

```python
# 适合作为API接口的返回值
{
    "status": "success",
    "data": [
        {"video_serial_number": "...", "video_content_summary": "...", ...},
        {"video_serial_number": "...", "video_content_summary": "...", ...}
    ],
    "count": 2
}
```

## 错误处理

工具提供完善的错误处理机制：

1. **JSON解析错误**：返回包含错误信息的对象数组
2. **字段缺失处理**：缺失字段返回空字符串
3. **类型转换保护**：确保所有数据类型都能安全转换
4. **文件操作异常**：保存文件时的异常处理

## 注意事项

1. **输出类型**：始终返回数组，即使输入是单个对象
2. **字段类型**：所有字段值都会被转换为字符串类型
3. **字段顺序**：输出对象中的字段顺序与映射配置一致
4. **编码格式**：文件保存使用 UTF-8 编码
5. **空值处理**：缺失或空值字段返回空字符串

## 系统兼容性

- ✅ **macOS**：完全支持
- ✅ **Windows**：完全支持
- ✅ **Linux**：完全支持
- ✅ **Python版本**：支持 Python 3.6+

## 总结

结构化数据格式化工具完美解决了截图中的输出参数配置问题：

1. **正确的输出结构**：Array<Object> 格式
2. **一组一组对应**：多组输入对应多组输出
3. **结构化数据**：便于API调用和数据处理
4. **类型统一**：所有字段都是字符串类型
5. **配置简单**：直接使用英文字段名

现在您可以在截图界面中正确配置输出参数：
- 主输出类型：Array
- 数组元素类型：Object
- 对象包含5个String类型的字段

这样就能实现多组杂乱输入对应多组结构化输出的需求。