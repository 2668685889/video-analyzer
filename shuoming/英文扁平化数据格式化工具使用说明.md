# 英文扁平化数据格式化工具使用说明

## 概述

英文扁平化数据格式化工具（`english_flat_formatter.py`）是一个专门处理英文字段名的数据格式化工具。该工具专为处理一级（扁平化）英文字段结构设计，所有输出均为字符串类型，完美解决了截图中 `key0`、`key1`、`key2` 等字段无法输出的问题。

## 主要特性

- ✅ **英文字段名支持**：使用标准英文字段名，告别 `key*` 形式
- ✅ **扁平化结构**：所有字段都在一级，无嵌套对象
- ✅ **字符串输出**：所有字段值统一转换为字符串类型
- ✅ **多组数据支持**：自动识别并处理单组或多组数据
- ✅ **类型自动转换**：支持数字、布尔值、数组、对象等类型的自动字符串转换
- ✅ **灵活配置**：支持自定义字段映射配置

## 默认英文字段映射

根据您的截图需求，工具提供以下5个英文字段名：

| 中文名称 | 英文字段名 | 数据类型 | 说明 |
|---------|-----------|----------|------|
| 视频序列号 | `video_serial_number` | String | 视频的唯一标识符 |
| 视频内容摘要 | `video_content_summary` | String | 视频内容的简要概述 |
| 详细内容描述 | `detailed_content_description` | String | 视频内容的详细描述 |
| 关键词标签 | `keyword_tags` | String | 相关关键词和标签 |
| 主要对象 | `main_objects` | String | 视频中的主要人物或对象 |

## 使用方法

### 1. 基本使用

```python
from english_flat_formatter import EnglishFlatFormatter

# 创建格式化器实例
formatter = EnglishFlatFormatter()

# 准备JSON数据（使用英文字段名）
json_data = '''{
    "video_serial_number": "VIDEO_20250124_001",
    "video_content_summary": "这是一个关于新政策的重要视频内容摘要",
    "detailed_content_description": "视频详细描述了最新的政策变化和实施细节",
    "keyword_tags": "政策, 法律, 解读, 重要通知",
    "main_objects": "政策制定者, 法律专家, 企业管理者"
}'''

# 格式化数据
result = formatter.format_data(json_data)
print(result)
```

### 2. 处理多组数据

```python
# 多组数据使用数组格式
multiple_data = '''[
    {
        "video_serial_number": "VIDEO_001",
        "video_content_summary": "第一个视频的内容摘要",
        "detailed_content_description": "第一个视频的详细内容描述",
        "keyword_tags": "关键词1, 关键词2, 关键词3",
        "main_objects": "主要对象1, 主要对象2"
    },
    {
        "video_serial_number": "VIDEO_002",
        "video_content_summary": "第二个视频的内容摘要",
        "detailed_content_description": "第二个视频的详细内容描述",
        "keyword_tags": "关键词4, 关键词5, 关键词6",
        "main_objects": "主要对象3, 主要对象4"
    }
]'''

result = formatter.format_data(multiple_data)
print(result)
```

### 3. 保存到文件

```python
# 格式化并保存到文件
formatted_data = formatter.format_data(json_data)
output_file = formatter.save_formatted_data(formatted_data, "output.txt")
print(f"结果已保存到: {output_file}")
```

### 4. 自定义字段映射

```python
# 创建自定义字段映射
custom_mapping = {
    "视频序列号": "serial_id",
    "视频内容摘要": "summary",
    "详细内容描述": "description",
    "关键词标签": "tags",
    "主要对象": "objects"
}

# 使用自定义映射创建格式化器
formatter = EnglishFlatFormatter(custom_mapping)
```

### 5. 动态更新字段映射

```python
# 更新字段映射
formatter.update_field_mapping({
    "视频序列号": "video_id",
    "视频内容摘要": "content_summary"
})

# 查看当前映射配置
print(formatter.get_field_mapping_info())
```

## 支持的数据类型

工具支持以下数据类型的自动字符串转换：

### 1. 字符串类型
```json
{
    "video_serial_number": "VIDEO_001"
}
```
输出：`视频序列号：VIDEO_001`

### 2. 数字类型
```json
{
    "video_serial_number": 12345
}
```
输出：`视频序列号：12345`

### 3. 布尔类型
```json
{
    "main_objects": true
}
```
输出：`主要对象：True`

### 4. 数组类型
```json
{
    "keyword_tags": ["标签1", "标签2", "标签3"]
}
```
输出：`关键词标签：标签1 标签2 标签3`

### 5. 简单对象类型
```json
{
    "detailed_content_description": {"text": "从对象中提取的描述"}
}
```
输出：`详细内容描述：从对象中提取的描述`

## 输出格式

### 单组数据输出格式
```
视频序列号：VIDEO_20250124_001
视频内容摘要：这是一个关于新政策的重要视频内容摘要
详细内容描述：视频详细描述了最新的政策变化和实施细节
关键词标签：政策, 法律, 解读, 重要通知
主要对象：政策制定者, 法律专家, 企业管理者
```

### 多组数据输出格式
```
=== 第1组数据 ===
视频序列号：VIDEO_001
视频内容摘要：第一个视频的内容摘要
详细内容描述：第一个视频的详细内容描述
关键词标签：关键词1, 关键词2, 关键词3
主要对象：主要对象1, 主要对象2

=== 第2组数据 ===
视频序列号：VIDEO_002
视频内容摘要：第二个视频的内容摘要
详细内容描述：第二个视频的详细内容描述
关键词标签：关键词4, 关键词5, 关键词6
主要对象：主要对象3, 主要对象4
```

## API 参考

### EnglishFlatFormatter 类

#### 构造函数
```python
EnglishFlatFormatter(field_mapping=None)
```
- `field_mapping` (dict, optional): 自定义字段映射配置

#### 主要方法

##### format_data(json_str)
格式化JSON数据为指定输出格式
- **参数**: `json_str` (str) - JSON字符串
- **返回**: `str` - 格式化后的字符串

##### save_formatted_data(formatted_data, output_file=None)
保存格式化数据到文件
- **参数**: 
  - `formatted_data` (str) - 格式化后的数据
  - `output_file` (str, optional) - 输出文件路径
- **返回**: `str` - 保存的文件路径

##### update_field_mapping(new_mapping)
更新字段映射配置
- **参数**: `new_mapping` (dict) - 新的字段映射

##### get_field_mapping()
获取当前字段映射配置
- **返回**: `dict` - 当前字段映射

##### get_english_field_names()
获取所有英文字段名列表
- **返回**: `list` - 英文字段名列表

##### get_field_mapping_info()
获取字段映射信息的详细说明
- **返回**: `str` - 字段映射信息

## 实际应用示例

### 针对截图中的参数配置

根据您提供的截图，以下是正确的参数填写方式：

| 参数名 | 变量类型 | 对应英文字段名 |
|--------|----------|----------------|
| key0 | str, String | `video_serial_number` |
| key1 | str, String | `video_content_summary` |
| key2 | {} Object | **改为一级字段** |
| key21 | str, String | `detailed_content_description` |
| key22 | str, String | `keyword_tags` |
| key23 | str, String | `main_objects` |

**重要说明**：由于工具采用扁平化结构，不再需要 `key2` 对象嵌套，所有字段都是一级字段。

### 正确的JSON数据结构

```json
{
    "video_serial_number": "您的视频序列号",
    "video_content_summary": "您的视频内容摘要",
    "detailed_content_description": "您的详细内容描述",
    "keyword_tags": "您的关键词标签",
    "main_objects": "您的主要对象"
}
```

## 错误处理

工具提供完善的错误处理机制：

1. **JSON解析错误**：当输入的JSON格式不正确时，返回具体的解析错误信息
2. **字段缺失处理**：当某个字段不存在时，输出空字符串而不是报错
3. **类型转换保护**：确保所有数据类型都能安全转换为字符串
4. **文件操作异常**：保存文件时的异常处理和错误提示

## 注意事项

1. **字段结构**：所有字段都必须是一级字段，不支持嵌套对象结构
2. **数据类型**：所有输出都会被转换为字符串类型
3. **字段命名**：使用标准英文字段名，避免使用 `key*` 形式
4. **编码格式**：文件保存使用 UTF-8 编码，确保中文内容正确显示
5. **多组数据**：使用数组格式 `[{}, {}, {}]` 来表示多组数据

## 系统兼容性

- ✅ **macOS**：完全支持
- ✅ **Windows**：完全支持
- ✅ **Linux**：完全支持
- ✅ **Python版本**：支持 Python 3.6+

## 与原版工具的区别

| 特性 | 原版工具 | 英文扁平化工具 |
|------|----------|----------------|
| 字段名格式 | `key0`, `key1`, `key2` | 标准英文字段名 |
| 数据结构 | 支持嵌套对象 | 扁平化一级字段 |
| 输出类型 | 混合类型 | 统一字符串类型 |
| 配置复杂度 | 需要路径映射 | 直接字段映射 |
| 使用难度 | 中等 | 简单 |

## 总结

英文扁平化数据格式化工具完美解决了您在截图中遇到的问题：

1. **告别 `key*` 形式**：使用标准英文字段名
2. **扁平化结构**：所有字段都在一级，无需嵌套
3. **字符串统一**：所有输出都是字符串类型
4. **简单易用**：直接使用英文字段名作为JSON键
5. **功能完整**：支持单组、多组数据处理和文件保存

现在您可以直接使用 `video_serial_number`、`video_content_summary`、`detailed_content_description`、`keyword_tags`、`main_objects` 这5个英文字段名来构建您的JSON数据，工具会自动识别并格式化输出。