# 通用数据格式化工具使用说明

## 概述

`universal_data_formatter.py` 是一个通用的数据格式化工具，专门用于处理任意JSON键名结构的数据。与原始的 `data_formatter.py` 不同，这个工具支持 `key0`、`key1`、`key2` 等任意键名的数据格式化。

## 主要特性

- **支持任意JSON键名**：可以处理 `key0`、`key1`、`key2` 等键名结构
- **嵌套对象访问**：支持 `key2.key21` 这样的嵌套路径访问
- **灵活的字段映射**：可自定义输出字段名与JSON键名的映射关系
- **多种数据类型支持**：字符串、数组、对象、数字等
- **单组和多组数据处理**：自动识别数据格式
- **可配置性强**：支持动态更新字段映射

## 默认字段映射配置

```python
{
    "视频序列号": "key0",
    "视频内容摘要": "key1", 
    "详细内容描述": "key2.key21",
    "关键词标签": "key2.key22",
    "主要对象": "key2.key23"
}
```

## 使用方法

### 1. 基本使用

```python
from universal_data_formatter import UniversalDataFormatter

# 创建格式化器实例（使用默认映射）
formatter = UniversalDataFormatter()

# 准备JSON数据
json_data = '''{
    "key0": "VIDEO_20250824_001",
    "key1": ["视频摘要内容"],
    "key2": {
        "key21": "详细描述内容",
        "key22": "关键词1, 关键词2",
        "key23": "主要对象描述"
    }
}'''

# 格式化数据
result = formatter.format_data(json_data)
print(result)
```

### 2. 处理多组数据

```python
# 多组数据（数组格式）
multiple_data = '''[
    {
        "key0": "VIDEO_001",
        "key1": ["第一个视频摘要"],
        "key2": {
            "key21": "第一个视频详细描述",
            "key22": "关键词1, 关键词2",
            "key23": "对象1"
        }
    },
    {
        "key0": "VIDEO_002",
        "key1": ["第二个视频摘要"],
        "key2": {
            "key21": "第二个视频详细描述",
            "key22": "关键词3, 关键词4",
            "key23": "对象2"
        }
    }
]'''

result = formatter.format_data(multiple_data)
print(result)
```

### 3. 自定义字段映射

```python
# 自定义字段映射
custom_mapping = {
    "视频ID": "videoId",
    "标题": "title",
    "描述": "description",
    "作者姓名": "author.name",
    "发布时间": "publishTime"
}

# 创建自定义格式化器
custom_formatter = UniversalDataFormatter(custom_mapping)

# 使用自定义映射格式化数据
custom_data = '''{
    "videoId": "V001",
    "title": "自定义标题",
    "description": "自定义描述",
    "author": {
        "name": "张三",
        "email": "zhangsan@example.com"
    },
    "publishTime": "2025-01-24"
}'''

result = custom_formatter.format_data(custom_data)
print(result)
```

### 4. 保存到文件

```python
# 格式化数据并保存到文件
result = formatter.format_data(json_data)
output_file = formatter.save_formatted_data(result, "my_output.txt")
print(f"结果已保存到: {output_file}")
```

### 5. 动态更新字段映射

```python
# 获取当前映射配置
current_mapping = formatter.get_field_mapping()
print("当前映射:", current_mapping)

# 更新部分映射
formatter.update_field_mapping({
    "新字段": "new_key",
    "视频序列号": "video_id"  # 修改现有映射
})
```

## 支持的数据类型

### 1. 字符串类型
```json
{
    "key0": "直接字符串值"
}
```

### 2. 数组类型
```json
{
    "key1": ["数组元素1", "数组元素2"]
}
```

### 3. 对象数组类型
```json
{
    "key1": [
        {"text": "文本内容1", "type": "text"},
        {"text": "文本内容2", "type": "text"}
    ]
}
```

### 4. 嵌套对象类型
```json
{
    "key2": {
        "key21": "嵌套值1",
        "key22": "嵌套值2"
    }
}
```

### 5. 数字类型
```json
{
    "key0": 12345
}
```

## 输出格式

### 单组数据输出
```
视频序列号：VIDEO_20250824_001
视频内容摘要：这是一个关于社保新规的视频 内容非常重要
详细内容描述：视频详细描述了从9月1日起生效的社保新规定
关键词标签：社保, 法律, 企业管理, 劳动法
主要对象：企业主, 法律顾问
```

### 多组数据输出
```
=== 第1组数据 ===
视频序列号：VIDEO_001
视频内容摘要：第一个视频摘要
详细内容描述：第一个视频的详细描述
关键词标签：关键词1, 关键词2
主要对象：对象1

=== 第2组数据 ===
视频序列号：VIDEO_002
视频内容摘要：第二个视频摘要
详细内容描述：第二个视频的详细描述
关键词标签：关键词3, 关键词4
主要对象：对象2
```

## API 参考

### UniversalDataFormatter 类

#### 构造函数
```python
UniversalDataFormatter(field_mapping=None)
```
- `field_mapping` (dict, optional): 自定义字段映射配置

#### 主要方法

##### format_data(json_str)
格式化JSON数据
- **参数**: `json_str` (str) - JSON字符串
- **返回**: `str` - 格式化后的字符串

##### save_formatted_data(formatted_data, output_file=None)
保存格式化数据到文件
- **参数**: 
  - `formatted_data` (str) - 格式化后的数据
  - `output_file` (str, optional) - 输出文件路径
- **返回**: `str` - 保存的文件路径

##### update_field_mapping(new_mapping)
更新字段映射配置
- **参数**: `new_mapping` (dict) - 新的映射配置

##### get_field_mapping()
获取当前字段映射配置
- **返回**: `dict` - 当前映射配置的副本

## 路径访问语法

支持点号分隔的嵌套路径访问：

- `key0` - 访问根级别的 key0
- `key2.key21` - 访问 key2 对象下的 key21
- `author.profile.name` - 多级嵌套访问

## 错误处理

工具包含完善的错误处理机制：

1. **JSON解析错误**：输入不是有效JSON时
2. **路径访问错误**：指定路径不存在时返回空字符串
3. **数据类型错误**：自动处理不同数据类型的转换
4. **文件保存错误**：文件写入失败时的错误提示

## 实际应用示例

### 处理截图中的参数配置

根据您提供的截图，参数配置应该是：

```python
# 创建格式化器（使用默认配置即可）
formatter = UniversalDataFormatter()

# 您的JSON数据应该是这样的结构：
your_data = '''{
    "key0": "视频序列号值",
    "key1": ["视频内容摘要"],
    "key2": {
        "key21": "详细内容描述"
    }
}'''

# 格式化输出
result = formatter.format_data(your_data)
print(result)
```

### 配置说明

在您的输出参数配置界面中：

- **key0** (String类型) → 对应 "视频序列号"
- **key1** (Array<String>类型) → 对应 "视频内容摘要"
- **key2** (Object类型) → 包含子对象
  - **key21** (String类型) → 对应 "详细内容描述"
  - **key22** (String类型) → 对应 "关键词标签"（可选）
  - **key23** (String类型) → 对应 "主要对象"（可选）

## 注意事项

1. **键名匹配**：确保JSON数据中的键名与映射配置中的路径一致
2. **数据类型**：工具会自动处理不同数据类型的转换
3. **嵌套访问**：使用点号分隔嵌套路径（如 `key2.key21`）
4. **编码支持**：输出文件使用UTF-8编码，支持中文字符
5. **扩展性**：可以随时添加新的字段映射或修改现有映射

## 系统兼容性

- 支持 macOS、Windows、Linux 系统
- 需要 Python 3.6 或更高版本
- 无需额外依赖包，使用Python标准库

## 与原版工具的区别

| 特性 | 原版 data_formatter.py | 通用版 universal_data_formatter.py |
|------|----------------------|----------------------------------|
| 键名支持 | 固定中文键名 | 任意键名，可配置映射 |
| 嵌套访问 | 不支持 | 支持点号路径访问 |
| 字段映射 | 固定映射 | 可自定义映射 |
| 数据类型 | 有限支持 | 全面支持多种类型 |
| 扩展性 | 较低 | 高度可配置 |

通用版本完全解决了您提到的key0、key1、key2键名无法处理的问题，现在可以完美支持任意JSON键名结构的数据格式化。